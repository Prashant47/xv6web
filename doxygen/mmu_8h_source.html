<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Xv6 with picoc &amp; Linkage editor: mmu.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Xv6 with picoc &amp; Linkage editor
   &#160;<span id="projectnumber">v1.0</span>
   </div>
   <div id="projectbrief">The project delineate mutual cohesion between c library, linkage editor ( linker), interpreter and operating system by porting the same on xv6 kernel</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">mmu.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// This file contains definitions for the </span>
<a name="l00002"></a>00002 <span class="comment">// x86 memory management unit (MMU).</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">// Eflags register</span>
<a name="l00005"></a>00005 <span class="preprocessor">#define FL_CF           0x00000001      // Carry Flag</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor">#define FL_PF           0x00000004      // Parity Flag</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor">#define FL_AF           0x00000010      // Auxiliary carry Flag</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#define FL_ZF           0x00000040      // Zero Flag</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#define FL_SF           0x00000080      // Sign Flag</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">#define FL_TF           0x00000100      // Trap Flag</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">#define FL_IF           0x00000200      // Interrupt Enable</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor">#define FL_DF           0x00000400      // Direction Flag</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor">#define FL_OF           0x00000800      // Overflow Flag</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor">#define FL_IOPL_MASK    0x00003000      // I/O Privilege Level bitmask</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#define FL_IOPL_0       0x00000000      //   IOPL == 0</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#define FL_IOPL_1       0x00001000      //   IOPL == 1</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#define FL_IOPL_2       0x00002000      //   IOPL == 2</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#define FL_IOPL_3       0x00003000      //   IOPL == 3</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#define FL_NT           0x00004000      // Nested Task</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define FL_RF           0x00010000      // Resume Flag</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define FL_VM           0x00020000      // Virtual 8086 mode</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#define FL_AC           0x00040000      // Alignment Check</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define FL_VIF          0x00080000      // Virtual Interrupt Flag</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#define FL_VIP          0x00100000      // Virtual Interrupt Pending</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#define FL_ID           0x00200000      // ID flag</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>
<a name="l00027"></a>00027 <span class="comment">// Control Register flags</span>
<a name="l00028"></a>00028 <span class="preprocessor">#define CR0_PE          0x00000001      // Protection Enable</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#define CR0_MP          0x00000002      // Monitor coProcessor</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#define CR0_EM          0x00000004      // Emulation</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#define CR0_TS          0x00000008      // Task Switched</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#define CR0_ET          0x00000010      // Extension Type</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#define CR0_NE          0x00000020      // Numeric Errror</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#define CR0_WP          0x00010000      // Write Protect</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#define CR0_AM          0x00040000      // Alignment Mask</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#define CR0_NW          0x20000000      // Not Writethrough</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#define CR0_CD          0x40000000      // Cache Disable</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#define CR0_PG          0x80000000      // Paging</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#define CR4_PSE         0x00000010      // Page size extension</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="preprocessor">#define SEG_KCODE 1  // kernel code</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#define SEG_KDATA 2  // kernel data+stack</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define SEG_KCPU  3  // kernel per-cpu data</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#define SEG_UCODE 4  // user code</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#define SEG_UDATA 5  // user data+stack</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#define SEG_TSS   6  // this process&#39;s task state</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 <span class="comment">//PAGEBREAK!</span>
<a name="l00050"></a>00050 <span class="preprocessor">#ifndef __ASSEMBLER__</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="comment">// Segment Descriptor</span>
<a name="l00052"></a><a class="code" href="structsegdesc.html">00052</a> <span class="keyword">struct </span><a class="code" href="structsegdesc.html">segdesc</a> {
<a name="l00053"></a>00053   uint lim_15_0 : 16;  <span class="comment">// Low bits of segment limit</span>
<a name="l00054"></a>00054   uint base_15_0 : 16; <span class="comment">// Low bits of segment base address</span>
<a name="l00055"></a>00055   uint base_23_16 : 8; <span class="comment">// Middle bits of segment base address</span>
<a name="l00056"></a>00056   uint type : 4;       <span class="comment">// Segment type (see STS_ constants)</span>
<a name="l00057"></a>00057   uint s : 1;          <span class="comment">// 0 = system, 1 = application</span>
<a name="l00058"></a>00058   uint dpl : 2;        <span class="comment">// Descriptor Privilege Level</span>
<a name="l00059"></a>00059   uint p : 1;          <span class="comment">// Present</span>
<a name="l00060"></a>00060   uint lim_19_16 : 4;  <span class="comment">// High bits of segment limit</span>
<a name="l00061"></a>00061   uint avl : 1;        <span class="comment">// Unused (available for software use)</span>
<a name="l00062"></a>00062   uint rsv1 : 1;       <span class="comment">// Reserved</span>
<a name="l00063"></a>00063   uint db : 1;         <span class="comment">// 0 = 16-bit segment, 1 = 32-bit segment</span>
<a name="l00064"></a>00064   uint g : 1;          <span class="comment">// Granularity: limit scaled by 4K when set</span>
<a name="l00065"></a>00065   uint base_31_24 : 8; <span class="comment">// High bits of segment base address</span>
<a name="l00066"></a>00066 };
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">// Normal segment</span>
<a name="l00069"></a>00069 <span class="preprocessor">#define SEG(type, base, lim, dpl) (struct segdesc)    \</span>
<a name="l00070"></a>00070 <span class="preprocessor">{ ((lim) &gt;&gt; 12) &amp; 0xffff, (uint)(base) &amp; 0xffff,      \</span>
<a name="l00071"></a>00071 <span class="preprocessor">  ((uint)(base) &gt;&gt; 16) &amp; 0xff, type, 1, dpl, 1,       \</span>
<a name="l00072"></a>00072 <span class="preprocessor">  (uint)(lim) &gt;&gt; 28, 0, 0, 1, 1, (uint)(base) &gt;&gt; 24 }</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#define SEG16(type, base, lim, dpl) (struct segdesc)  \</span>
<a name="l00074"></a>00074 <span class="preprocessor">{ (lim) &amp; 0xffff, (uint)(base) &amp; 0xffff,              \</span>
<a name="l00075"></a>00075 <span class="preprocessor">  ((uint)(base) &gt;&gt; 16) &amp; 0xff, type, 1, dpl, 1,       \</span>
<a name="l00076"></a>00076 <span class="preprocessor">  (uint)(lim) &gt;&gt; 16, 0, 0, 1, 0, (uint)(base) &gt;&gt; 24 }</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>
<a name="l00079"></a>00079 <span class="preprocessor">#define DPL_USER    0x3     // User DPL</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="comment">// Application segment type bits</span>
<a name="l00082"></a>00082 <span class="preprocessor">#define STA_X       0x8     // Executable segment</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#define STA_E       0x4     // Expand down (non-executable segments)</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor">#define STA_C       0x4     // Conforming code segment (executable only)</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor">#define STA_W       0x2     // Writeable (non-executable segments)</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor">#define STA_R       0x2     // Readable (executable segments)</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#define STA_A       0x1     // Accessed</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a>00089 <span class="comment">// System segment type bits</span>
<a name="l00090"></a>00090 <span class="preprocessor">#define STS_T16A    0x1     // Available 16-bit TSS</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor">#define STS_LDT     0x2     // Local Descriptor Table</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">#define STS_T16B    0x3     // Busy 16-bit TSS</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="preprocessor">#define STS_CG16    0x4     // 16-bit Call Gate</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#define STS_TG      0x5     // Task Gate / Coum Transmitions</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#define STS_IG16    0x6     // 16-bit Interrupt Gate</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor">#define STS_TG16    0x7     // 16-bit Trap Gate</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor">#define STS_T32A    0x9     // Available 32-bit TSS</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="preprocessor">#define STS_T32B    0xB     // Busy 32-bit TSS</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="preprocessor">#define STS_CG32    0xC     // 32-bit Call Gate</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span><span class="preprocessor">#define STS_IG32    0xE     // 32-bit Interrupt Gate</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span><span class="preprocessor">#define STS_TG32    0xF     // 32-bit Trap Gate</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103 <span class="comment">// A virtual address &#39;la&#39; has a three-part structure as follows:</span>
<a name="l00104"></a>00104 <span class="comment">//</span>
<a name="l00105"></a>00105 <span class="comment">// +--------10------+-------10-------+---------12----------+</span>
<a name="l00106"></a>00106 <span class="comment">// | Page Directory |   Page Table   | Offset within Page  |</span>
<a name="l00107"></a>00107 <span class="comment">// |      Index     |      Index     |                     |</span>
<a name="l00108"></a>00108 <span class="comment">// +----------------+----------------+---------------------+</span>
<a name="l00109"></a>00109 <span class="comment">//  \--- PDX(va) --/ \--- PTX(va) --/ </span>
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment">// page directory index</span>
<a name="l00112"></a>00112 <span class="preprocessor">#define PDX(va)         (((uint)(va) &gt;&gt; PDXSHIFT) &amp; 0x3FF)</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>
<a name="l00114"></a>00114 <span class="comment">// page table index</span>
<a name="l00115"></a>00115 <span class="preprocessor">#define PTX(va)         (((uint)(va) &gt;&gt; PTXSHIFT) &amp; 0x3FF)</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>
<a name="l00117"></a>00117 <span class="comment">// construct virtual address from indexes and offset</span>
<a name="l00118"></a>00118 <span class="preprocessor">#define PGADDR(d, t, o) ((uint)((d) &lt;&lt; PDXSHIFT | (t) &lt;&lt; PTXSHIFT | (o)))</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a>00120 <span class="comment">// Page directory and page table constants.</span>
<a name="l00121"></a>00121 <span class="preprocessor">#define NPDENTRIES      1024    // # directory entries per page directory</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span><span class="preprocessor">#define NPTENTRIES      1024    // # PTEs per page table</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">#define PGSIZE          4096    // bytes mapped by a page</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>
<a name="l00125"></a>00125 <span class="preprocessor">#define PGSHIFT         12      // log2(PGSIZE)</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span><span class="preprocessor">#define PTXSHIFT        12      // offset of PTX in a linear address</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span><span class="preprocessor">#define PDXSHIFT        22      // offset of PDX in a linear address</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129 <span class="preprocessor">#define PGROUNDUP(sz)  (((sz)+PGSIZE-1) &amp; ~(PGSIZE-1))</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span><span class="preprocessor">#define PGROUNDDOWN(a) (((a)) &amp; ~(PGSIZE-1))</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>
<a name="l00132"></a>00132 <span class="comment">// Page table/directory entry flags.</span>
<a name="l00133"></a>00133 <span class="preprocessor">#define PTE_P           0x001   // Present</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span><span class="preprocessor">#define PTE_W           0x002   // Writeable</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span><span class="preprocessor">#define PTE_U           0x004   // User</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span><span class="preprocessor">#define PTE_PWT         0x008   // Write-Through</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span><span class="preprocessor">#define PTE_PCD         0x010   // Cache-Disable</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="preprocessor">#define PTE_A           0x020   // Accessed</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span><span class="preprocessor">#define PTE_D           0x040   // Dirty</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span><span class="preprocessor">#define PTE_PS          0x080   // Page Size</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span><span class="preprocessor">#define PTE_MBZ         0x180   // Bits must be zero</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span><span class="preprocessor">#define PROT_WRITE PTE_W</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span><span class="preprocessor">#define MAP_PRIVATE PTE_P|PTE_W|PTE_U</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span><span class="preprocessor">#define MAP_ANONYMOUS MAP_PRIVATE</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a>00146 <span class="comment">// Address in page table or page directory entry</span>
<a name="l00147"></a>00147 <span class="preprocessor">#define PTE_ADDR(pte)   ((uint)(pte) &amp; ~0xFFF)</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span>
<a name="l00149"></a>00149 <span class="preprocessor">#ifndef __ASSEMBLER__</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span><span class="keyword">typedef</span> uint pte_t;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="comment">// Task state segment format</span>
<a name="l00153"></a><a class="code" href="structtaskstate.html">00153</a> <span class="keyword">struct </span><a class="code" href="structtaskstate.html">taskstate</a> {
<a name="l00154"></a>00154   uint link;         <span class="comment">// Old ts selector</span>
<a name="l00155"></a>00155   uint esp0;         <span class="comment">// Stack pointers and segment selectors</span>
<a name="l00156"></a>00156   ushort ss0;        <span class="comment">//   after an increase in privilege level</span>
<a name="l00157"></a>00157   ushort padding1;
<a name="l00158"></a>00158   uint *esp1;
<a name="l00159"></a>00159   ushort ss1;
<a name="l00160"></a>00160   ushort padding2;
<a name="l00161"></a>00161   uint *esp2;
<a name="l00162"></a>00162   ushort ss2;
<a name="l00163"></a>00163   ushort padding3;
<a name="l00164"></a>00164   <span class="keywordtype">void</span> *cr3;         <span class="comment">// Page directory base</span>
<a name="l00165"></a>00165   uint *eip;         <span class="comment">// Saved state from last task switch</span>
<a name="l00166"></a>00166   uint eflags;
<a name="l00167"></a>00167   uint eax;          <span class="comment">// More saved state (registers)</span>
<a name="l00168"></a>00168   uint ecx;
<a name="l00169"></a>00169   uint edx;
<a name="l00170"></a>00170   uint ebx;
<a name="l00171"></a>00171   uint *esp;
<a name="l00172"></a>00172   uint *ebp;
<a name="l00173"></a>00173   uint esi;
<a name="l00174"></a>00174   uint edi;
<a name="l00175"></a>00175   ushort es;         <span class="comment">// Even more saved state (segment selectors)</span>
<a name="l00176"></a>00176   ushort padding4;
<a name="l00177"></a>00177   ushort cs;
<a name="l00178"></a>00178   ushort padding5;
<a name="l00179"></a>00179   ushort ss;
<a name="l00180"></a>00180   ushort padding6;
<a name="l00181"></a>00181   ushort ds;
<a name="l00182"></a>00182   ushort padding7;
<a name="l00183"></a>00183   ushort fs;
<a name="l00184"></a>00184   ushort padding8;
<a name="l00185"></a>00185   ushort gs;
<a name="l00186"></a>00186   ushort padding9;
<a name="l00187"></a>00187   ushort ldt;
<a name="l00188"></a>00188   ushort padding10;
<a name="l00189"></a>00189   ushort t;          <span class="comment">// Trap on task switch</span>
<a name="l00190"></a>00190   ushort iomb;       <span class="comment">// I/O map base address</span>
<a name="l00191"></a>00191 };
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment">// PAGEBREAK: 12</span>
<a name="l00194"></a>00194 <span class="comment">// Gate descriptors for interrupts and traps</span>
<a name="l00195"></a><a class="code" href="structgatedesc.html">00195</a> <span class="keyword">struct </span><a class="code" href="structgatedesc.html">gatedesc</a> {
<a name="l00196"></a>00196   uint off_15_0 : 16;   <span class="comment">// low 16 bits of offset in segment</span>
<a name="l00197"></a>00197   uint cs : 16;         <span class="comment">// code segment selector</span>
<a name="l00198"></a>00198   uint args : 5;        <span class="comment">// # args, 0 for interrupt/trap gates</span>
<a name="l00199"></a>00199   uint rsv1 : 3;        <span class="comment">// reserved(should be zero I guess)</span>
<a name="l00200"></a>00200   uint type : 4;        <span class="comment">// type(STS_{TG,IG32,TG32})</span>
<a name="l00201"></a>00201   uint s : 1;           <span class="comment">// must be 0 (system)</span>
<a name="l00202"></a>00202   uint dpl : 2;         <span class="comment">// descriptor(meaning new) privilege level</span>
<a name="l00203"></a>00203   uint p : 1;           <span class="comment">// Present</span>
<a name="l00204"></a>00204   uint off_31_16 : 16;  <span class="comment">// high bits of offset in segment</span>
<a name="l00205"></a>00205 };
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="comment">// Set up a normal interrupt/trap gate descriptor.</span>
<a name="l00208"></a>00208 <span class="comment">// - istrap: 1 for a trap (= exception) gate, 0 for an interrupt gate.</span>
<a name="l00209"></a>00209 <span class="comment">//   interrupt gate clears FL_IF, trap gate leaves FL_IF alone</span>
<a name="l00210"></a>00210 <span class="comment">// - sel: Code segment selector for interrupt/trap handler</span>
<a name="l00211"></a>00211 <span class="comment">// - off: Offset in code segment for interrupt/trap handler</span>
<a name="l00212"></a>00212 <span class="comment">// - dpl: Descriptor Privilege Level -</span>
<a name="l00213"></a>00213 <span class="comment">//        the privilege level required for software to invoke</span>
<a name="l00214"></a>00214 <span class="comment">//        this interrupt/trap gate explicitly using an int instruction.</span>
<a name="l00215"></a>00215 <span class="preprocessor">#define SETGATE(gate, istrap, sel, off, d)                \</span>
<a name="l00216"></a>00216 <span class="preprocessor">{                                                         \</span>
<a name="l00217"></a>00217 <span class="preprocessor">  (gate).off_15_0 = (uint)(off) &amp; 0xffff;                \</span>
<a name="l00218"></a>00218 <span class="preprocessor">  (gate).cs = (sel);                                      \</span>
<a name="l00219"></a>00219 <span class="preprocessor">  (gate).args = 0;                                        \</span>
<a name="l00220"></a>00220 <span class="preprocessor">  (gate).rsv1 = 0;                                        \</span>
<a name="l00221"></a>00221 <span class="preprocessor">  (gate).type = (istrap) ? STS_TG32 : STS_IG32;           \</span>
<a name="l00222"></a>00222 <span class="preprocessor">  (gate).s = 0;                                           \</span>
<a name="l00223"></a>00223 <span class="preprocessor">  (gate).dpl = (d);                                       \</span>
<a name="l00224"></a>00224 <span class="preprocessor">  (gate).p = 1;                                           \</span>
<a name="l00225"></a>00225 <span class="preprocessor">  (gate).off_31_16 = (uint)(off) &gt;&gt; 16;                  \</span>
<a name="l00226"></a>00226 <span class="preprocessor">}</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span>
<a name="l00228"></a>00228 <span class="preprocessor">#endif</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 4 2016 21:55:51 for Xv6 with picoc & Linkage editor by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
